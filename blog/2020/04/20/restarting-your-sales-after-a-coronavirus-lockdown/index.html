<!doctype html><html lang=en dir=ltr><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Restarting your sales after a coronavirus lockdown | Boaz Sobrado's Website</title>
<meta name=generator content="Hugo Eureka 0.9.3"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@sobradob"><meta name=twitter:title content="Restarting your sales after a coronavirus lockdown"><meta name=twitter:description content="Using a MCMC BTYD model to estimate which of your clients would have purchased had the lockdown not happened."><meta name=twitter:image content="https://boazsobrado.com/images/icon.png"><link rel=stylesheet href=https://boazsobrado.com/css/eureka.min.0459970152b745d13c7565ea2c6b0779808d795515dcf00ca28653fadbd12bed43035022f720718ed11fdffd5b4e7009.css><script defer src=https://boazsobrado.com/js/eureka.min.fa9a6bf6d7a50bb635b4cca7d2ba5cf3dfb095ae3798773f1328f7950028b48c17d06276594e1b5f244a25a6c969a705.js></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&amp;family=Noto+Serif+SC:wght@400;600;700&amp;display=swap" as=style onload='this.onload=null,this.rel="stylesheet"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/styles/base16/solarized-light.min.css media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/highlight.min.js crossorigin></script><script defer src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.4.0/build/languages/dart.min.js crossorigin></script><link rel=stylesheet href=https://boazsobrado.com/css/highlightjs.min.2958991528e43eb6fc9b8c4f2b8e052f79c4010718e1d1e888a777620e9ee63021c2c57ec7417a3108019bb8c41943e6.css media=print onload='this.media="all",this.onload=null'><script defer type=text/javascript src=https://boazsobrado.com/js/fontawesome.min.8f55fc818d6fce0446d0f57d11099812f13adb5a0b8eba42ebb0eb390415a166430395f8b6fa40eb7af6a7ec5a0bd89a.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ media=print onload='this.media="all",this.onload=null' crossorigin><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}]})})</script><script defer src=https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js integrity=sha384-atOyb0FxAgN9LyAc6PEf9BjgwLISyansgdH8/VXQH8p2o5vfrRgmGIJ2Sg22L0A0 crossorigin></script><link rel=icon type=image/png sizes=32x32 href=https://boazsobrado.com/images/icon_hu546329292729773971.png><link rel=apple-touch-icon sizes=180x180 href=https://boazsobrado.com/images/icon_hu16414047889438337432.png><meta name=description content="Using a MCMC BTYD model to estimate which of your clients would have purchased had the lockdown not happened."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blog","item":"https://boazsobrado.com/blog/"},{"@type":"ListItem","position":2,"name":"Restarting your sales after a coronavirus lockdown","item":"https://boazsobrado.com/blog/2020/04/20/restarting-your-sales-after-a-coronavirus-lockdown/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://boazsobrado.com/blog/2020/04/20/restarting-your-sales-after-a-coronavirus-lockdown/"},"headline":"Restarting your sales after a coronavirus lockdown | Boaz Sobrado\u0027s Website","datePublished":"2020-04-20T13:11:22+08:00","dateModified":"2020-04-20T13:11:22+08:00","wordCount":1127,"publisher":{"@type":"Person","name":"Boaz Sobrado","logo":{"@type":"ImageObject","url":"https://boazsobrado.com/images/icon.png"}},"description":"Using a MCMC BTYD model to estimate which of your clients would have purchased had the lockdown not happened."}</script><meta property="og:title" content="Restarting your sales after a coronavirus lockdown | Boaz Sobrado's Website"><meta property="og:type" content="article"><meta property="og:image" content="https://boazsobrado.com/images/icon.png"><meta property="og:url" content="https://boazsobrado.com/blog/2020/04/20/restarting-your-sales-after-a-coronavirus-lockdown/"><meta property="og:description" content="Using a MCMC BTYD model to estimate which of your clients would have purchased had the lockdown not happened."><meta property="og:locale" content="en"><meta property="og:site_name" content="Boaz Sobrado's Website"><meta property="article:published_time" content="2020-04-20T13:11:22+08:00"><meta property="article:modified_time" content="2020-04-20T13:11:22+08:00"><meta property="article:section" content="blog"><meta property="og:see_also" content="https://boazsobrado.com/blog/2021/01/15/disrupting-ransom-payments/"><body class="flex min-h-screen flex-col"><header class="min-h-16 pl-scrollbar bg-secondary-bg fixed z-50 flex w-full items-center shadow-sm"><div class="mx-auto w-full max-w-screen-xl"><script>let storageColorScheme=localStorage.getItem("lightDarkMode");((storageColorScheme=="Auto"||storageColorScheme==null)&&window.matchMedia("(prefers-color-scheme: dark)").matches||storageColorScheme=="Dark")&&document.getElementsByTagName("html")[0].classList.add("dark")</script><nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0"><a href=/ class="me-6 text-primary-text text-xl font-bold">Boaz Sobrado's Website</a>
<button id=navbar-btn class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
<i class="fas fa-bars"></i></button><div id=target class="hidden block md:flex md:grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20"><div class="md:flex md:h-16 text-sm md:grow pb-4 md:pb-0 border-b md:border-b-0"><a href=/#about class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">About</a>
<a href=/blog/ class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 selected-menu-item me-4">Blog</a>
<a href=/series/media class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2 border-transparent me-4">Media</a></div><div class=flex><div class="relative pt-4 md:pt-0"><div class="cursor-pointer hover:text-eureka" id=lightDarkMode><i class="fas fa-adjust"></i></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id=is-open></div><div class="absolute flex flex-col start-0 md:start-auto end-auto md:end-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40" id=lightDarkOptions><span class="px-4 py-1 hover:text-eureka" name=Light>Light</span>
<span class="px-4 py-1 hover:text-eureka" name=Dark>Dark</span>
<span class="px-4 py-1 hover:text-eureka" name=Auto>Auto</span></div></div></div></div><div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id=is-open-mobile></div></nav><script>let element=document.getElementById("lightDarkMode");storageColorScheme==null||storageColorScheme=="Auto"?document.addEventListener("DOMContentLoaded",()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",switchDarkMode)}):storageColorScheme=="Light"?(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","sun"),element.firstElementChild.classList.add("fa-sun")):storageColorScheme=="Dark"&&(element.firstElementChild.classList.remove("fa-adjust"),element.firstElementChild.setAttribute("data-icon","moon"),element.firstElementChild.classList.add("fa-moon")),document.addEventListener("DOMContentLoaded",()=>{getcolorscheme(),switchBurger()})</script></div></header><main class="grow pt-16"><div class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl lg:px-4 xl:px-8"><div class="grid grid-cols-2 gap-4 lg:grid-cols-8 lg:pt-12"><div class="bg-secondary-bg col-span-2 rounded px-6 py-8 lg:col-span-6"><article class=prose><h1 class=mb-4>Restarting your sales after a coronavirus lockdown</h1><div class="text-tertiary-text not-prose mt-2 flex flex-row flex-wrap items-center"><div class="me-6 my-2"><i class="fas fa-calendar me-1"></i>
<span>2020-04-20</span></div><div class="me-6 my-2"><i class="fas fa-clock me-1"></i>
<span>6 min read</span></div><div class="me-6 my-2"><i class="fas fa-th-list me-1"></i>
<a href=https://boazsobrado.com/series/op-ed/ class=hover:text-eureka>Op Ed</a></div></div><p>As I write this, a novel strain of coronavirus (colloquially known as <em>the rona</em>) has a global lockdown. Unemployment rates are skyrocketing, the stock market has dropped substantially, but not nearly as much as consumer sentiment. Millions of businesses around the world, from small businesses like nail salons to tech giants like Airbnb are now facing the same problem: no revenues. At this point, we can only guess how long lockdowns will last. But there are encouraging signs that governments have decided to open. <a href=https://www.euractiv.com/section/coronavirus/news/austrias-government-presents-covid-19-exit-schedule/>Austria plans to be open in May</a>. For cash strapped businesses, it is essential to get back into action as soon as possible.</p><p><strong>In this post, I will show how you can predict who would have purchased from your business, had the lockdowns not happened.</strong></p><p>Once the lockdown is over, they are the customers you want to reach out to first. Of course, caveats apply: this does not apply to all business types and the world may not be the same after the virus as it was prior to the virus.</p><h2 id=buy-till-you-die>Buy till you die</h2><p>According to <a href=https://en.wikipedia.org/wiki/Buy_Till_you_Die>Wikipedia</a>:</p><blockquote><p>The Buy Till You Die (BTYD) class of statistical models are designed to capture the behavioral characteristics of non-contractual customers, or when the company is not able to directly observe when a customer stops being a customer of a brand. The goal is typically to model and forecast customer lifetime value.</p><p>BTYD models all jointly model two processes: a repeat purchase process, that explains how frequently customers make purchases while they are still &ldquo;alive&rdquo;; and a dropout process, which models how likely a customer is to churn in any given time period.</p></blockquote><p>In other words, the aim of the model is:</p><ul><li>estimate how frequently the customer will purchase</li><li>estimate when the customer will stop purchasing (die)</li></ul><p>An advantage of BTYD models is that they only require information on the purchase history of customers. For example:</p><table><thead><tr><th>Customer ID</th><th>Date</th><th>Purchase Type</th><th>USD Value</th></tr></thead><tbody><tr><td>1</td><td>2020-01-01</td><td>New Widget</td><td>15</td></tr><tr><td>2</td><td>2020-01-01</td><td>New Widget</td><td>20</td></tr><tr><td>1</td><td>2020-01-10</td><td>Used Widget</td><td>5</td></tr></tbody></table><p>Using this information we can compute for each customer:</p><ul><li>The number of repeat transactions per customer (frequency)</li><li>The time of the last recorded transaction (recency)</li><li>The date of the first transaction</li><li>The duration of time between the first transaction and the end of the calibration period</li></ul><p>This information is sufficient to fit most BTYD models to estimate orders. Some models can also incorporate:</p><ul><li>Total sales in USD</li><li>The sum over logarithmic intertransaction times (to incorporate purchase regularity into the model)</li><li>Any other customer level covariate (e.g. is the customer a student?)</li></ul><h3 id=markov-chain-monte-carlo-methods>Markov Chain Monte Carlo Methods</h3><p>In this case, our primary concern is not to estimate the customer lifetime value, or to figure our which one of our customers is &ldquo;dead&rdquo;, but rather to figure out which customer would have purchased from us had the lockdown not happened.</p><p>This is where Markov Chain Monte Carlo methods come in. According to <a href=https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo>Wikipedia</a>:</p><blockquote><p>In statistics, Markov chain Monte Carlo (MCMC) methods comprise a class of algorithms for sampling from a probability distribution.</p></blockquote><p>MCMC methods make it (relatively) simple to estimate probabilities using that would be otherwise hard (or impossible) to compute.</p><p>In our case the probability distribution we are interested in is not P(Alive), nor the distribubtion of orders a customer will make over a given timeframe (the length of the lockdown), but rather the probability that a customer will make at least one purchase over the length of the lockdown.</p><h3 id=example-implementing-the-model>Example: implementing the model</h3><p>To implement the model we use the <a href=https://cran.r-project.org/web/packages/BTYDplus/vignettes/BTYDplus-HowTo.pdf>BTYD plus</a> package in R which contains multiple BTYD models. In our case we will use the Abe (2009) model, which allows for predictors to be included.</p><p>For this example we&rsquo;ll use a data set which consists of purchases made by customers of CDNOW in the late 1990s. CDNOW was a billion dollar tech company during the dotcom bubble, which was eventually absorbed by Amazon.</p><p>After importing the data and some pre-processing (detailed in the link above), we make the assumption that the pandemic induced lockdowns lasts for two months (from April 1998 to June 1998).</p><pre><code>cdnowCbs &lt;- elog2cbs(cdnowElog,
                     T.cal = &quot;1998-04-30&quot;, T.tot = &quot;1998-06-30&quot;)

</code></pre><p>Afterwards, we end up with a dataframe that includes the following columns:</p><table><thead><tr><th style=text-align:right>cust</th><th style=text-align:right>x</th><th style=text-align:right>t.x</th><th style=text-align:right>sales</th><th style=text-align:left>first</th><th style=text-align:right>T.cal</th><th style=text-align:right>T.star</th><th style=text-align:right>x.star</th><th style=text-align:right>sales.star</th><th style=text-align:right>first.sales</th></tr></thead><tbody><tr><td style=text-align:right>4</td><td style=text-align:right>3</td><td style=text-align:right>49.285714</td><td style=text-align:right>100.50</td><td style=text-align:left>1997-01-01</td><td style=text-align:right>69.14286</td><td style=text-align:right>8.714286</td><td style=text-align:right>0</td><td style=text-align:right>0</td><td style=text-align:right>0.02933</td></tr><tr><td style=text-align:right>18</td><td style=text-align:right>0</td><td style=text-align:right>0.000000</td><td style=text-align:right>14.96</td><td style=text-align:left>1997-01-04</td><td style=text-align:right>68.71429</td><td style=text-align:right>8.714286</td><td style=text-align:right>0</td><td style=text-align:right>0</td><td style=text-align:right>0.01496</td></tr><tr><td style=text-align:right>21</td><td style=text-align:right>1</td><td style=text-align:right>1.714286</td><td style=text-align:right>75.11</td><td style=text-align:left>1997-01-01</td><td style=text-align:right>69.14286</td><td style=text-align:right>8.714286</td><td style=text-align:right>0</td><td style=text-align:right>0</td><td style=text-align:right>0.06334</td></tr></tbody></table><p>This includes the customer id (cust), the number of repeat transactions (x), the total sales of the customer (sales), the date of the first transaction (first), the duration of time between the first transaction and the end of the calibration period (T.cal).</p><p>In our case, we have the data for the period between 1998-04-30 and 1998-06-30, so we also know the actual observed orders in that period (x.star) and value of these sales (sales.star).</p><p>In addition, we also included the (scaled) value of the first purchase as a covariate. Now, it is time to run the model.</p><pre><code>
# draws model parameters using the MCMC methods
draws.m2 &lt;- abe.mcmc.DrawParameters(cdnowCbs, covariates = c(&quot;first.sales&quot;),
                                    mcmc = 7500, burnin = 2500)

# using the drawn parameters estimates how many orders the each customer will make
draws_xstar &lt;- mcmc.DrawFutureTransactions(cdnowCbs,draws.m2)

# calculates P(Active) for each customer using the distribution of orders
cdnowCbs$pActive &lt;- mcmc.PActive(draws_xstar)

</code></pre><p>First, we have to check that the MCMC model has converged. Basically, we want to make sure that the parameters estimated by the MCMC model aren&rsquo;t complete nonsense.</p><p>There are <a href=http://sbfnk.github.io/mfiidd/mcmc_diagnostics.html>multiple ways of doing this</a>, which we will not go into, but on a superficial level it looks that the model has convergence is okayish. Not great, but not completely useless either.</p><p><img alt=traceplots.png src=http://boazsobrado.com/images/traceplots.png></p><p>Lets see the results:</p><table><thead><tr><th style=text-align:left>Group P(Active)</th><th style=text-align:right>Observed P(Active)</th><th style=text-align:right>Predicted P(Active)</th><th style=text-align:right>Customers</th></tr></thead><tbody><tr><td style=text-align:left>A: Over 75%</td><td style=text-align:right>0.66</td><td style=text-align:right>0.85</td><td style=text-align:right>32</td></tr><tr><td style=text-align:left>B: Between 50% and 75%</td><td style=text-align:right>0.59</td><td style=text-align:right>0.61</td><td style=text-align:right>73</td></tr><tr><td style=text-align:left>C: Between 25% and 50%</td><td style=text-align:right>0.29</td><td style=text-align:right>0.34</td><td style=text-align:right>250</td></tr><tr><td style=text-align:left>D: Less than 25%</td><td style=text-align:right>0.05</td><td style=text-align:right>0.05</td><td style=text-align:right>2002</td></tr></tbody></table><p>It seems that the model is overestimating the probability of being active at the tail end of customers. We could try to improve the MCMC mixing, or add new predictors.</p><p>Nonetheless, these estimates may be sufficient for our purposes.</p><h3 id=summary--next-steps>Summary & Next steps</h3><p>What you do with this prediction depends to a great extent on your business model, how much each customer is worth, etc. One approach would be to segment your outreach based on the likelihood that they would have purchased.</p><p>For example:</p><ul><li>Group A: send them a card/call them.</li><li>Group B: email with new offers.</li><li>Group C: email with a discount code. They need a little bit more of a push to order.</li><li>Group D: email with a larger discount code. These clients were likely lost before the pandemic.</li></ul></article><div class="-mx-2 mt-4 flex flex-col border-t px-2 pt-4 md:flex-row md:justify-between"><div><span class="text-primary-text block font-bold">Previous</span>
<a href=https://boazsobrado.com/blog/2020/05/22/a-day-using-money-in-cuba/ class=block>A day using money in Cuba</a></div><div class="mt-4 md:mt-0 md:text-right"><span class="text-primary-text block font-bold">Next</span>
<a href=https://boazsobrado.com/blog/2019/08/12/automating-my-business/ class=block>Automating my business</a></div></div></div><div class=col-span-2><div class="bg-secondary-bg prose max-w-none rounded p-6"><h3>Series of Posts</h3><a href=https://boazsobrado.com/blog/2021/01/15/disrupting-ransom-payments/ class=no-underline>Disrupting ransom payments</a><br><a href=https://boazsobrado.com/blog/2020/04/20/restarting-your-sales-after-a-coronavirus-lockdown/ class=no-underline>Restarting your sales after a coronavirus lockdown</a><br></div><div class="bg-primary-bg
prose sticky top-16 z-10 hidden px-6 py-4 lg:block"><h3>On This Page</h3></div><div class="sticky-toc hidden px-6 pb-6 lg:block"><nav id=TableOfContents><ul><li><a href=#buy-till-you-die>Buy till you die</a><ul><li><a href=#markov-chain-monte-carlo-methods>Markov Chain Monte Carlo Methods</a></li><li><a href=#example-implementing-the-model>Example: implementing the model</a></li><li><a href=#summary--next-steps>Summary & Next steps</a></li></ul></li></ul></nav></div><script>window.addEventListener("DOMContentLoaded",()=>{enableStickyToc()})</script></div></div><script>document.addEventListener("DOMContentLoaded",()=>{hljs.highlightAll()})</script></div></div></main><footer class=pl-scrollbar><div class="mx-auto w-full max-w-screen-xl"><div class="text-center p-6 pin-b"><p class="text-sm text-tertiary-text">&copy; 2024 <a href=https://www.boazsobrado.com/>Boaz Sobrado</a>
&#183; Powered by the <a href=https://github.com/wangchucheng/hugo-eureka class=hover:text-eureka>Eureka</a> theme for <a href=https://gohugo.io class=hover:text-eureka>Hugo</a></p></div></div></footer></body></html>